<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Details</title>

    <style>
        body { font-family: Arial, sans-serif; background: #eef3f8; margin: 0; padding: 0; }
        .header { background: #007bff; color: white; padding: 18px; font-size: 22px; text-align: center; font-weight: bold; }

        .reminder-box {
            background:#fff8d6;
            border-left:5px solid #f1c232;
            padding:12px 15px;
            margin:15px auto;
            max-width:700px;
            font-size:15px;
            color:#8a6d00;
            border-radius:8px;
            display:none;
            word-break: break-all;
        }

        .container { max-width: 700px; background: white; margin: 30px auto; padding: 25px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); }

        .row { margin-bottom: 18px; }
        .label { font-weight: bold; margin-bottom: 4px; display: block; color: #222; }
        .value { font-size: 16px; color: #444; }

        .status-box { padding: 12px; border-radius: 8px; font-weight: bold; display: inline-block; margin-top: 6px; }
        .status-pending { background: #fff3cd; color: #b58b00; }
        .status-paid_waiting { background: #cfe2ff; color: #084298; }
        .status-completed { background: #d1e7dd; color: #0f5132; }
        .status-unknown { background: #e2e3e5; color: #41464b; }

        .footer { text-align: center; margin-top: 40px; color: #777; font-size: 14px; }
    </style>
</head>

<body>

<div class="header">Order Details</div>

<!-- ðŸ”¥ REMINDER BOX (Nháº¯c khÃ¡ch copy link) -->
<div id="reminder" class="reminder-box">
    <b>Important:</b> Please save this page link to check your order later.<br>
    <span id="currentLink" style="font-weight:bold;"></span>
</div>

<div class="container">

    <div class="row">
        <span class="label">Order ID:</span>
        <span id="orderId" class="value">...</span>
    </div>

    <div class="row">
        <span class="label">Status:</span>
        <span id="statusBox" class="status-box status-unknown">Loading...</span>
    </div>

    <div class="row">
        <span class="label">Total Amount:</span>
        <span id="amount" class="value">...</span> USDT
    </div>

    <!-- Hidden fields (Contact / User Note / Posts) -->
    <div class="row" style="display:none;">
        <span class="label">Contact:</span>
        <span id="contact" class="value"></span>
    </div>

    <div class="row" style="display:none;">
        <span class="label">Customer Note:</span>
        <div id="userNote"></div>
    </div>

    <div class="row" style="display:none;">
        <span class="label">Posts:</span>
        <div id="posts"></div>
    </div>

</div>

<div style="text-align:center; margin-top:25px;">
    <a href="index.html">
        <button style="
            background:#007bff;
            color:white;
            padding:12px 24px;
            border:none;
            border-radius:8px;
            font-size:16px;
            cursor:pointer;
        ">
            â¬… Back to Home
        </button>
    </a>
</div>

<div class="footer">Website created by Toridochi</div>

<script>

function translateStatus(s) {
    switch (s) {
        case "pending_payment": return { text: "Waiting for seller to confirm your payment", css: "status-pending" };
        case "paid_waiting_confirmation": return { text: "Waiting for Seller Confirmation", css: "status-paid_waiting" };
        case "completed": return { text: "Completed", css: "status-completed" };
        default: return { text: s, css: "status-unknown" };
    }
}

async function loadOrder() {
    const url = new URL(window.location.href);
    const id = url.searchParams.get("id");
    const t  = url.searchParams.get("t");

    if (!id || !t) {
        document.getElementById("statusBox").innerText = "Invalid tracking link.";
        return;
    }

    const res = await fetch(`/api/orders/status?id=${id}&t=${t}`);
    let data;

    try { data = await res.json(); }
    catch { document.getElementById("statusBox").innerText = "Error loading order."; return; }

    if (!data.order) {
        document.getElementById("statusBox").innerText = "Order not found.";
        return;
    }

    const order = data.order;

    // Display only safe information
    document.getElementById("orderId").innerText = order.id;
    document.getElementById("amount").innerText = order.price;

    const statusInfo = translateStatus(order.status);
    const statusEl = document.getElementById("statusBox");
    statusEl.innerText = statusInfo.text;
    statusEl.className = `status-box ${statusInfo.css}`;

    // ðŸ”¥ Show banner reminding customer to save the link
    const reminder = document.getElementById("reminder");
    reminder.style.display = "block";
    document.getElementById("currentLink").innerText = window.location.href;

    // Hide everything sensitive
    document.getElementById("contact").innerText = "";
    document.getElementById("userNote").innerText = "";
    document.getElementById("posts").innerHTML = "";
}

loadOrder();
</script>

</body>
</html>
