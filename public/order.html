<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Order Details</title>

<style>

/* =====================
   BASE LIGHT MODE
   ===================== */

body {
    font-family: Arial, sans-serif;
    background: #eef3f8;
    margin: 0;
    padding: 0;
}

.header {
    background: #007bff;
    color: white;
    padding: 18px;
    font-size: 22px;
    text-align: center;
    font-weight: bold;
}

.container {
    max-width: 700px;
    background: white;
    margin: 30px auto;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
}

.row {
    margin-bottom: 18px;
}

.label {
    font-weight: bold;
    margin-bottom: 4px;
    display: block;
    color: #222;
}

.value {
    font-size: 16px;
    color: #444;
}

.status-box {
    padding: 12px;
    border-radius: 8px;
    font-weight: bold;
    display: inline-block;
    margin-top: 6px;
}

.status-pending { background: #fff3cd; color: #b58b00; }
.status-paid_waiting { background: #cfe2ff; color: #084298; }
.status-completed { background: #d1e7dd; color: #0f5132; }
.status-unknown { background: #e2e3e5; color: #41464b; }

.note-box {
    background: #fff7e6;
    padding: 12px;
    border-left: 4px solid #ffb84d;
    border-radius: 6px;
    white-space: pre-wrap;
}

.post-box {
    background: #f8f9fa;
    padding: 12px;
    border-radius: 8px;
    margin-top: 12px;
}

a {
    color: #007bff;
    word-break: break-all;
}

.footer {
    text-align: center;
    margin-top: 40px;
    color: #777;
    font-size: 14px;
}

/* ðŸ”” REMINDER BOX */
.reminder-box {
    background:#ffe08a;
    border-left:6px solid #ff9900;
    padding:15px 18px;
    margin:18px auto;
    max-width:700px;
    font-size:16px;
    color:#7a4b00;
    border-radius:10px;
    display:none;
    font-weight:600;
    box-shadow:0 2px 6px rgba(0,0,0,0.15);
}

.copy-btn {
    margin-top:10px;
    background:#ff9900;
    color:white;
    padding:8px 14px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:14px;
    font-weight:bold;
    transition:0.2s;
}

.copy-btn:hover {
    background:#cc7a00;
}

.copy-btn.copied {
    background:#28a745 !important;
}

.link-display {
    margin-top:8px;
    background:#fff3d4;
    padding:8px 10px;
    border-radius:6px;
    font-size:14px;
    word-break:break-all;
}

/* =====================
   DARK MODE
   ===================== */

body.dark {
    background: #0f1117 !important;
    color: #e8e8e8 !important;
}

body.dark .header {
    background: #0b5bd9 !important;
}

body.dark .container {
    background: #181a20 !important;
    color: #e8e8e8 !important;
}

body.dark .label {
    color: #d7d7d7 !important;
}

body.dark .value {
    color: #e6e6e6 !important;
}

body.dark .post-box {
    background: #1e222a !important;
    border: 1px solid #2f333a !important;
}

body.dark a {
    color: #4a90ff !important;
}

body.dark .note-box {
    background: #1e2025 !important;
    border-left-color: #ffaa3c !important;
    color: #e8e8e8 !important;
}

body.dark .status-pending {
    background:#655d2a !important;
    color:#ffe083 !important;
}
body.dark .status-paid_waiting {
    background:#2b3b55 !important;
    color:#9ec5ff !important;
}
body.dark .status-completed {
    background:#1d3b2e !important;
    color:#74d6a1 !important;
}
body.dark .status-unknown {
    background:#3a3a3c !important;
    color:#d1d1d1 !important;
}

body.dark .reminder-box {
    background:#2e2620 !important;
    border-left-color:#ff9900 !important;
    color:#ffd89d !important;
}

body.dark .link-display {
    background:#3a2f24 !important;
    color:#ffe0b3 !important;
}

body.dark .copy-btn {
    background:#1e5cff !important;
}

body.dark .footer {
    color: #aaaaaa !important;
}

/* =====================
   DARK MODE TOGGLE
   ===================== */

.theme-toggle {
    position: fixed;
    top: 18px;
    right: 18px;
    background: #fff;
    width: 46px;
    height: 46px;
    border-radius: 50%;
    box-shadow: 0 4px 14px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 22px;
    z-index: 9999;
    transition: 0.25s;
}

body.dark .theme-toggle {
    background: #1e2025;
    color: #eee;
}

</style>
</head>

<body>

<div class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</div>

<div class="header">Order Details</div>

<!-- ðŸ”¥ REMINDER BOX -->
<div id="reminder" class="reminder-box">
    ðŸ”” <b>Important:</b> Please save this page link to check your order later.
    <div id="currentLink" class="link-display"></div>
    <button class="copy-btn" onclick="copyLink()">Copy Link</button>
</div>

<div class="container">

    <div class="row">
        <span class="label">Order ID:</span>
        <span id="orderId" class="value">...</span>
    </div>

    <div class="row">
        <span class="label">Status:</span>
        <span id="statusBox" class="status-box status-unknown">Loading...</span>
    </div>

    <div class="row">
        <span class="label">Total Amount:</span>
        <span id="amount" class="value">...</span> USDT
    </div>

    <div class="row">
        <span class="label">Contact:</span>
        <span id="contact" class="value">...</span>
    </div>

    <div class="row">
        <span class="label">Customer Note:</span>
        <div id="userNote" class="note-box">(No note)</div>
    </div>

    <div class="row">
        <span class="label">Posts:</span>
        <div id="posts"></div>
    </div>

</div>

<div style="text-align:center; margin-top:25px;">
    <a href="index.html">
        <button style="
            background:#007bff;
            color:white;
            padding:12px 24px;
            border:none;
            border-radius:8px;
            font-size:16px;
            cursor:pointer;
        ">
            â¬… Back to Home
        </button>
    </a>
</div>

<div class="footer">Website created by Toridochi</div>

<script>

/* ========= THEME SYSTEM ========= */

function applyTheme(theme) {
    if (theme === "dark") {
        document.body.classList.add("dark");
        document.querySelector(".theme-toggle").innerHTML = "â˜€ï¸";
    } else {
        document.body.classList.remove("dark");
        document.querySelector(".theme-toggle").innerHTML = "ðŸŒ™";
    }
}

function toggleTheme() {
    const newTheme = document.body.classList.contains("dark") ? "light" : "dark";
    localStorage.setItem("themeMode", newTheme);
    applyTheme(newTheme);
}

// Load saved theme
(function() {
    let saved = localStorage.getItem("themeMode");
    if (!saved) {
        saved = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        localStorage.setItem("themeMode", saved);
    }
    applyTheme(saved);
})();

/* ========= ORDER LOGIC ========= */

function translateStatus(s) {
    switch (s) {
        case "pending_payment": return { text: "Waiting for seller to confirm your payment", css: "status-pending" };
        case "paid_waiting_confirmation": return { text: "Waiting for Seller Confirmation", css: "status-paid_waiting" };
        case "completed": return { text: "Completed", css: "status-completed" };
        default: return { text: s, css: "status-unknown" };
    }
}

async function loadOrder() {
    const url = new URL(window.location.href);
    const id = url.searchParams.get("id");
    const t  = url.searchParams.get("t");

    if (!id || !t) {
        document.getElementById("statusBox").innerText = "Invalid tracking link.";
        return;
    }

    const res = await fetch(`/api/orders/status?id=${id}&t=${t}`);
    let data;

    try { data = await res.json(); }
    catch { 
        document.getElementById("statusBox").innerText = "Error loading order."; 
        return; 
    }

    if (!data.order) {
        document.getElementById("statusBox").innerText = "Order not found.";
        return;
    }

    const order = data.order;

    // Populate data
    document.getElementById("orderId").innerText = order.id;
    document.getElementById("amount").innerText = order.price;
    document.getElementById("contact").innerText = order.contact;

    const statusInfo = translateStatus(order.status);
    const statusEl = document.getElementById("statusBox");
    statusEl.innerText = statusInfo.text;
    statusEl.className = `status-box ${statusInfo.css}`;

    // Parse note
    let noteData = {};
    try { noteData = JSON.parse(order.note || "{}"); }
    catch { noteData = {}; }

    const noteText =
        (noteData.user_note && noteData.user_note.trim() !== "")
            ? noteData.user_note
            : (noteData.customer_note && noteData.customer_note.trim() !== "")
                ? noteData.customer_note
                : "(No note)";

    document.getElementById("userNote").innerText = noteText;

    // Posts
    const postsBox = document.getElementById("posts");
    const posts = noteData.posts || [];
    postsBox.innerHTML = "";

    posts.forEach((p, i) => {
        postsBox.innerHTML += `
            <div class="post-box">
                <b>Post #${i+1}</b><br>
                <a href="${p.link}" target="_blank">${p.link}</a><br>
                ${p.views ? `Views: ${p.views}<br>` : ""}
                ${p.comments ? `Comments: ${p.comments}<br>` : ""}
                ${p.likes ? `Likes: ${p.likes}<br>` : ""}
                ${p.combo ? `Combo Packages: ${p.combo.count} Ã— 14 USDT<br>` : ""}
            </div>
        `;
    });

    // Show reminder box
    const reminder = document.getElementById("reminder");
    reminder.style.display = "block";
    document.getElementById("currentLink").innerText = window.location.href;
}

/* Copy tracking link */
function copyLink() {
    const link = window.location.href;
    navigator.clipboard.writeText(link).then(() => {
        const btn = document.querySelector(".copy-btn");
        const original = btn.innerText;

        btn.innerText = "âœ“ Copied!";
        btn.classList.add("copied");

        setTimeout(() => {
            btn.innerText = original;
            btn.classList.remove("copied");
        }, 1200);
    });
}

loadOrder();
</script>

</body>
</html>
