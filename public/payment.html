<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment - Complete Your Order</title>

<style>
/* Smooth theme transition (iOS style) */
* {
    transition: background-color 0.35s ease, 
                color 0.35s ease, 
                border-color 0.35s ease,
                box-shadow 0.35s ease;
}

body {
    transition: background-color 0.35s ease, color 0.35s ease;
}

.theme-toggle {
    transition: background-color 0.35s ease, color 0.35s ease, transform 0.25s;
}

.theme-toggle:active {
    transform: scale(0.78);
}
/* Avoid white flash before theme loads */
body {
    visibility: hidden;
}

body.theme-ready {
    visibility: visible;
}

   
/* =====================
   BASE LIGHT MODE
   ===================== */
body {
    font-family: Arial, sans-serif;
    background: #eef2f7;
    margin: 0;
    padding: 0;
}

.header {
    text-align: center;
    padding: 24px;
    background: #0d6efd;
    color: white;
    font-size: 22px;
    font-weight: bold;
}

.container {
    max-width: 680px;
    margin: 25px auto;
    background: white;
    padding: 25px;
    border-radius: 14px;
    box-shadow: 0 6px 22px rgba(0,0,0,0.08);
}

.section-title {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 14px;
}

.qr-box {
    text-align: center;
    margin: 20px 0;
    background: #fff;
    padding: 15px 0;
    border-radius: 12px;
}

.qr-box img {
    width: 260px;
    height: auto;
    border-radius: 10px;
}

.scan-text {
    font-size: 13px;
    color: #444;
    margin-top: 8px;
}

.wallet-box {
    background: #fafafa;
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #ddd;
    margin-top: 10px;
}

.wallet-address {
    font-family: monospace;
    font-size: 16px;
    margin-top: 12px;
    word-break: break-all;
    background: #fff;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ddd;
}

.copy-btn {
    margin-top:10px;
    padding:10px 14px;
    border-radius:8px;
    border:0;
    background:#0d6efd;
    color:white;
    cursor:pointer;
    font-size:14px;
}

.pay-btn {
    width: 100%;
    padding: 14px;
    background: #28a745;
    color: white;
    font-size: 18px;
    border: 0;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 25px;
}

.footer {
    text-align: center;
    margin: 35px 0 20px;
    font-size: 13px;
    color: #777;
}

/* =====================
   DARK MODE THEME
   ===================== */

body.dark {
    background: #0f1117 !important;
    color: #e8e8e8 !important;
}

body.dark .header {
    background: #0b5bd9 !important;
}

body.dark .container {
    background: #181a20 !important;
    color: #e8e8e8 !important;
}

body.dark .section-title {
    color: #e8e8e8 !important;
}

body.dark .qr-box {
    background: #181a20 !important;
}

body.dark .scan-text {
    color: #cccccc !important;
}

body.dark .wallet-box {
    background: #181a20 !important;
    border-color: #2f333a !important;
    color: #e8e8e8 !important;
}

body.dark .wallet-address {
    background: #111318 !important;
    border: 1px solid #3a3d45 !important;
    color: #ffffff !important;
}

body.dark .copy-btn {
    background: #1e5cff !important;
    color: white !important;
}

body.dark .pay-btn {
    background: #1f9e55 !important;
}

body.dark .footer {
    color: #bbbbbb !important;
}

/* =====================
   DARK MODE TOGGLE
   ===================== */

.theme-toggle {
    position: fixed;
    top: 18px;
    right: 18px;
    background: #fff;
    width: 46px;
    height: 46px;
    border-radius: 50%;
    box-shadow: 0 4px 14px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 22px;
    z-index: 9999;
    transition: 0.25s;
}

body.dark .theme-toggle {
    background: #1e2025;
    color: #eee;
}

/* =====================
   LOADING BUTTON
   ===================== */

.btn-loading {
    position: relative;
    pointer-events: none;
    opacity: 0.85;
}

.btn-loading:after {
    content: "";
    position: absolute;
    right: 18px;
    top: 50%;
    width: 16px;
    height: 16px;
    margin-top: -8px;
    border: 2px solid white;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

</style>
</head>

<body>

<!-- DARK MODE TOGGLE -->
<div class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</div>

<div class="header">Complete Your Payment</div>

<div class="container">

    <h2 class="section-title">Order Payment</h2>

    <p><b>Order ID:</b> <span id="order_id">Loading...</span></p>
    <p><b>Total Amount:</b> <span id="total_amount">Loading...</span> USDT</p>

    <div class="qr-box">
        <img src="qr-usdt.jpg" alt="USDT Payment QR">
        <p class="scan-text">Scan QR to pay</p>
    </div>

    <div class="wallet-box">
        <b>Wallet Address (USDC BASE):</b>
        <div class="wallet-address" id="wallet_addr">
            0x8f5308c729c111555fdae285a8a899281e7d71af
        </div>
        <button class="copy-btn" onclick="copyWallet()">
            Copy Address
        </button>
    </div>

    <button class="pay-btn" onclick="confirmPaid()">I Have Paid</button>
</div>

<div class="footer">
    Website created by Toridochi
</div>

<script>

/* =========================
   THEME SYSTEM (GLOBAL)
   ========================= */

function applyTheme(theme) {
    if (theme === "dark") {
        document.body.classList.add("dark");
        document.querySelector(".theme-toggle").innerHTML = "â˜€ï¸";
    } else {
        document.body.classList.remove("dark");
        document.querySelector(".theme-toggle").innerHTML = "ðŸŒ™";
    }
}

function toggleTheme() {
    const newTheme = document.body.classList.contains("dark") ? "light" : "dark";
    localStorage.setItem("themeMode", newTheme);
    applyTheme(newTheme);
}

// Load saved theme on page load
(function() {
    let saved = localStorage.getItem("themeMode");
    if (!saved) {
        saved = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        localStorage.setItem("themeMode", saved);
    }
    applyTheme(saved);
   document.body.classList.add("theme-ready");

})();

/* =========================
   PAYMENT LOGIC
   ========================= */

function getQuery(name) {
    return new URLSearchParams(window.location.search).get(name);
}

async function loadOrder() {
    const id = getQuery("id");
    const t  = getQuery("t");

    if (!id || !t) {
        document.getElementById("order_id").innerText = "Invalid link";
        return;
    }

    const res = await fetch(`/api/orders/status?id=${encodeURIComponent(id)}&t=${encodeURIComponent(t)}`);
    const data = await res.json();

    if (!data.order) {
        document.getElementById("order_id").innerText = "Order not found";
        return;
    }

    document.getElementById("order_id").innerText = id;
    document.getElementById("total_amount").innerText = data.order.price;
}

loadOrder();

function copyWallet() {
    const text = document.getElementById("wallet_addr").innerText;
    navigator.clipboard.writeText(text);
    alert("Wallet address copied!");
}

async function confirmPaid() {
    const id = getQuery("id");
    const t  = getQuery("t");

    const btn = document.querySelector(".pay-btn");
    btn.classList.add("btn-loading");
    btn.disabled = true;

    document.querySelectorAll("button").forEach(el => {
        if (el !== btn) el.disabled = true;
    });

    try {
        await fetch("https://polished-glade-ad1f.a1humada.workers.dev", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                type: "user_paid_click",
                orderId: id
            })
        });
    } catch (e) {
        console.log("Worker error:", e);
    } finally {
        window.location.href = `/order.html?id=${id}&t=${t}`;
    }
}

</script>

</body>
</html>
