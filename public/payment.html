<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment - Complete Your Order</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #eef2f7;
    margin: 0;
    padding: 0;
}
.header {
    text-align: center;
    padding: 24px;
    background: #0d6efd;
    color: white;
    font-size: 22px;
    font-weight: bold;
}
.container {
    max-width: 680px;
    margin: 25px auto;
    background: white;
    padding: 25px;
    border-radius: 14px;
    box-shadow: 0 6px 22px rgba(0,0,0,0.08);
}
.section-title {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 14px;
}
.qr-box {
    text-align: center;
    margin: 20px 0;
}
.qr-box img {
    width: 260px;
    height: auto;
    border-radius: 10px;
}
.wallet-box {
    background: #fafafa;
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #ddd;
    margin-top: 10px;
}
.wallet-address {
    font-family: monospace;
    font-size: 16px;
    margin-top: 12px;
    word-break: break-all;
    background: #fff;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ddd;
}
.pay-btn {
    width: 100%;
    padding: 14px;
    background: #28a745;
    color: white;
    font-size: 18px;
    border: 0;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 25px;
}
.footer {
    text-align: center;
    margin: 35px 0 20px;
    font-size: 13px;
    color: #777;
}
</style>
</head>

<body>

<div class="header">Complete Your Payment</div>

<div class="container">

    <h2 class="section-title">Order Payment</h2>

    <p><b>Order ID:</b> <span id="order_id">Loading...</span></p>
    <p><b>Total Amount:</b> <span id="total_amount">Loading...</span> USDT</p>

    <div class="qr-box">
        <img src="qr-usdt.jpg" alt="USDT Payment QR">
        <p style="font-size:13px;color:#444;">Scan QR to pay</p>
    </div>

    <div class="wallet-box">
        <b>Wallet Address (USDC BASE):</b>
        <div class="wallet-address" id="wallet_addr">
            0x8f5308c729c111555fdae285a8a899281e7d71af
        </div>
        <button onclick="copyWallet()" style="margin-top:10px;padding:10px;border-radius:8px;border:0;background:#0d6efd;color:white;cursor:pointer;">
            Copy Address
        </button>
    </div>

    <button class="pay-btn" onclick="confirmPaid()">I Have Paid</button>
</div>

<div class="footer">
    Website created by Toridochi
</div>

<script>
function getQuery(name) {
    return new URLSearchParams(window.location.search).get(name);
}

async function loadOrder() {
    const id = getQuery("id");
    const t  = getQuery("t");

    if (!id || !t) {
        document.getElementById("order_id").innerText = "Invalid link";
        return;
    }

    const res = await fetch(`/api/orders/status?id=${encodeURIComponent(id)}&t=${encodeURIComponent(t)}`);
    const data = await res.json();

    if (!data.order) {
        document.getElementById("order_id").innerText = "Order not found";
        return;
    }

    document.getElementById("order_id").innerText = id;
    document.getElementById("total_amount").innerText = data.order.price;
}

loadOrder();

function copyWallet() {
    const text = document.getElementById("wallet_addr").innerText;
    navigator.clipboard.writeText(text);
    alert("Wallet address copied!");
}

async function confirmPaid() {
    const id = getQuery("id");

    // üü¶ G·ª¨I T·ªöI WORKER ƒê·ªÇ BOT TELEGRAM B√ÅO "USER PAID"
    await fetch("https://polished-glade-ad1fa1.humada.workers.dev/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            type: "user_paid_click",
            orderId: id
        })
    });

    // üü¶ Sau ƒë√≥ ti·∫øp t·ª•c flow c≈©
    const t = getQuery("t");
    window.location.href = `/order.html?id=${id}&t=${t}`;
}
</script>

</body>
</html>
