<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Order</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    padding: 20px;
}
.container {
    max-width: 500px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.1);
}
h2 {
    text-align: center;
    margin-top: 0;
}
label {
    font-weight: bold;
    margin-top: 12px;
    display: block;
}
input, textarea {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
}
.service-box {
    margin-top: 15px;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: #fafafa;
}
button {
    width: 100%;
    padding: 12px;
    background: #0077ff;
    color: white;
    border: none;
    border-radius: 8px;
    margin-top: 20px;
    cursor: pointer;
}
#result {
    margin-top: 20px;
    padding: 15px;
    border-radius: 8px;
    background: #e7f3ff;
    display: none;
}
.price-note {
    font-size: 13px;
    color: #555;
}
</style>
</head>
<body>

<div class="container">

<h2>Create Order</h2>

<label>Post Link</label>
<input id="post_link" placeholder="https://x.com/...">

<label>Select Services</label>

<div class="service-box">
    <input type="checkbox" id="sv_view" onchange="toggleViewBox()"> Views<br>
    <div id="view_box" style="display:none; margin-top:10px;">
        <label>Number of Views</label>
        <input id="view_amount" type="number" min="5000" value="5000" oninput="updateTotal()">
        <div class="price-note">5000 views = $1. Each +1000 = $0.2</div>
    </div>
</div>

<div class="service-box">
    <input type="checkbox" id="sv_comment" onchange="toggleCommentBox()"> Comments<br>
    <div id="comment_box" style="display:none; margin-top:10px;">
        <label>Number of Comments</label>
        <input id="comment_amount" type="number" min="10" value="10" oninput="updateTotal()">
        <div class="price-note">10 comments = $3. +1 comment = $0.3<br>All comments from verified & relevant.</div>
    </div>
</div>

<div class="service-box">
    <input type="checkbox" id="sv_like" onchange="toggleLikeBox()"> Likes<br>
    <div id="like_box" style="display:none; margin-top:10px;">
        <label>Number of Likes</label>
        <input id="like_amount" type="number" min="100" value="100" oninput="updateTotal()">
        <div class="price-note">100 likes = $2. +10 likes = $0.2</div>
    </div>
</div>

<label>Contact (Email or X handle)</label>
<input id="contact">

<label>Note (Optional)</label>
<textarea id="note"></textarea>

<h3>Total: <span id="total_price">0</span> USD</h3>

<button onclick="createOrder()">Create Order</button>

<div id="result"></div>

</div>

<script>

function toggleViewBox() {
    document.getElementById("view_box").style.display =
        document.getElementById("sv_view").checked ? "block" : "none";
    updateTotal();
}

function toggleCommentBox() {
    document.getElementById("comment_box").style.display =
        document.getElementById("sv_comment").checked ? "block" : "none";
    updateTotal();
}

function toggleLikeBox() {
    document.getElementById("like_box").style.display =
        document.getElementById("sv_like").checked ? "block" : "none";
    updateTotal();
}

function updateTotal() {
    let total = 0;

    // Views pricing
    if (document.getElementById("sv_view").checked) {
        let v = parseInt(document.getElementById("view_amount").value || 0);
        if (v >= 5000) {
            total += 1; // base price
            total += Math.max(0, (v - 5000) / 1000) * 0.2;
        }
    }

    // Comment pricing
    if (document.getElementById("sv_comment").checked) {
        let c = parseInt(document.getElementById("comment_amount").value || 0);
        if (c >= 10) {
            total += 3; // base price
            total += Math.max(0, (c - 10)) * 0.3;
        }
    }

    // Like pricing
    if (document.getElementById("sv_like").checked) {
        let l = parseInt(document.getElementById("like_amount").value || 0);
        if (l >= 100) {
            total += 2; // base price
            total += Math.max(0, (l - 100) / 10) * 0.2;
        }
    }

    document.getElementById("total_price").innerText = total.toFixed(2);
    return total;
}

async function createOrder() {
    const total = updateTotal();

    const services = {
        views: document.getElementById("sv_view").checked ? parseInt(document.getElementById("view_amount").value) : 0,
        comments: document.getElementById("sv_comment").checked ? parseInt(document.getElementById("comment_amount").value) : 0,
        likes: document.getElementById("sv_like").checked ? parseInt(document.getElementById("like_amount").value) : 0
    };

    const body = {
        post_link: document.getElementById("post_link").value,
        package: "custom",
        contact: document.getElementById("contact").value,
        note: JSON.stringify({ services }),
        price: total
    };

    const res = await fetch("/api/orders/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
    });

    const data = await res.json();

    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = `
        <h3>Order Created</h3>
        <p><b>Price:</b> ${data.price} ${data.currency}</p>
        <p><b>Pay to:</b> ${data.pay_address}</p>
        <p><b>Your tracking link:</b><br>
        <a href="${data.tracking_url}">${data.tracking_url}</a></p>
    `;
}

</script>

</body>
</html>
